<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/fyxq.css" rel="stylesheet" />
		<script type="text/javascript" src="../js/lib/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="../js/lib/flexible.js"></script>
		<script type="text/javascript" src="../js/lib/flexible_css.js"></script>
		<link rel="stylesheet" type="text/css" href="../css/style_a_d.css"/>
		<link rel="stylesheet" type="text/css" href="../css/a_fringe.css"/>
	</head>
		<header class="mui-bar mui-bar-nav wd-header_p ipx_public_h1">
		    <div class="">
		    	<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left a_d"></a>
		    	<!--<span class="titlezi topic" ></span>-->
		    	<h1 class="mui-title topic"></h1>
		    </div>
		</header>
		<div class="mui-content fyzhuti">
		    <div class="fyxqyi">
		    	<!--轮播1-->
		    	<div class="liageda">
		    		<div id="slider" class="mui-slider" style="position: relative;">
					  <div class="mui-slider-group mui-slider-loop">
					    <!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) 12-->
					 
					  </div>
					  <div class="mui-slider-indicator imglunbo"></div>
					</div>
					<div class="qieryun qieryundisp"></div>
					<div class="fuxqxx">
						<div class="fyxqxxyiu">
							<p class="fybh"></p>
							<p class="qierldetu qierlyundelainjie qierldetudisp">
								<span></span>
							</p>
						</div>
						<div class="fyxqxxer">
							<ul>
								<li>
									<p class="danjia" >单价</p>
									<p class="danyuan dj" ></p>
								</li>
								<li>
									<p class="danjia">月租金</p>
									<p class="danyuan yzj"></p>
								</li>
								<li>
									<p class="danjia">面积</p>
									<p class="danyuan fjmj"></p>
								</li>
							</ul>
						</div>
						<div class="fyxqxxsan">
							<div class="zhognxiu">
								<span class="zhognxiuyi">
									<i class="fjzt"></i>
								</span>
								<span class="kezhuce zc"></span>
							</div>
							<ul>
								<li>
									<p class="stkrgw">
										<span class="kognwrgwei">可容工位:</span>
										<span class="neirong krgw"></span>
									</p>
									<p class="stkrgw">
										<span class="kognwrgwei">产权性质:</span>
										<span class="neirong chqxz"></span>
									</p>
								</li>
								<li>
									<p class="stkrgw">
										<span class="kognwrgwei">房间楼层:</span>
										<span class="neirong lc"></span>
									</p>
									<p class="stkrgw">
										<span class="kognwrgwei">房间朝向:</span>
										<span class="neirong chx"></span>
									</p>
								</li>
								<li>
									<p class="stkrgw">
										<span class="kognwrgwei">房间层高:</span>
										<span class="neirong fjcg"></span>
									</p>
									<p class="stkrgw">
										<span class="kognwrgwei">物业费:</span>
										<span class="neirong wyf"></span>
									</p>
								</li>
								<li>
									<p class="stkrgw">
										<span class="kognwrgwei">建成年代:</span>
										<span class="neirong kprq"></span>
									</p>
									<p class="stkrgw">
										<span class="kognwrgwei">供暖费:</span>
										<span class="neirong gnf"></span>
									</p>
								</li>
								<li>
									<p class="stkrgw">
										<span class="kognwrgwei">网络公司:</span>
										<span class="neirong wlgs"></span>
									</p>
									<p class="stkrgw">
										<span class="kognwrgwei">停车费:</span>
										<span class="neirong tcf"></span>
									</p>
								</li>
								<li>
									<p class="">
										<span class="kognwrgwei">物业公司:</span>
										<span class="neirong wygs"></span>
									</p>
								</li>
								
							</ul>
						</div>
					</div>
					<div class="wuyfsdceng"></div>
					<div class="xshogwen">
						<div class="xshgwedi">
							<span class="xshgwedier kognwrgwei">销售顾问：</span>
							<span class="neirong name">亮狮管家</span>
						</div>
						<div class="lianxfangs">
							<span class="xshgwedier kognwrgwei">联系方式：</span>
							<span class="lainsier phone">400-078-8800</span>
						</div>
					</div>
					<div class="wuyfsdceng"></div>
		    	</div>
				<div class="shouc">
					<p class="shoucengdianji">
						<span class="xindebg xindebgimg"></span>
						<span class="choucdewezi choucdeweziwidth" onclick="logonJudge()">未收藏</span>
					</p>
					<p class="xmjx">
						<a href="tel:400-078-8800" class="a_d">
							<span class="xmjxlx"></span>
							<span class="lainxixingmql">联系亮狮管家</span>
						</a>
					</p>
				</div>
		    </div>
		</div>
	<body>
		<script src="../js/mui.min.js"></script>
		<script src="../js/lib/app_config.js"></script>
		<script type="text/javascript" src="../js/lib/castapp.js" ></script>
		<script type="text/javascript">
			mui.plusReady(function(){
				var collectId="";
				var le=0;
				var fyid="";
				var self = plus.webview.currentWebview();
                fyid = self.fyid;
                localStorage.setItem('fyid',self.fyid);
                if(fyid == ''){
                	fyid = localStorage.getItem('fyid');
                }
			var cookieId=JSON.parse(localStorage.getItem('cookxs_yh'));
		(function(){
			detailData();
			jugeHouse();
		})();
			//获得slider插件对象
			var gallery = mui('.mui-slider');
			gallery.slider({
			  interval:3000//自动轮播周期，若为0则不自动播放，默认为0；
			});
			/*注意:如果ajax获得图片后，需要在写入图片以后，需要从新调用一下*/
			gallery.slider();
				mui.init();
				
				//监听从登陆返回会来的事件
				window.addEventListener("fanhuidaofxqq", function (e) {
				    //获得事件参数
				    var ttt = e.detail.ttt;
			    	var wobj = plus.webview.getWebviewById("fyTail");
					wobj.reload(true);
				});
				
			var titlet = '';
			var lianjiedizhi = '';
			/*房源数据*/
			function detailData(){
			mui.ajax(Interface_url+'/yhcms/web/lpjbxx/getWxFyxx.do',{
				data:{
							"parameters":{"hourse_id":fyid},
							"foreEndType":2,
							"code":"30000004"
						},
				dataType:'json',//服务器返回json格式数据
				type:'post',//HTTP请求类型
				timeout:100000,//超时时间设置为10秒；
				headers:{'Content-Type':'application/json'},	              
				success:function(data){
					if(data.success){
						var data = data.data;
							for(var i=0;i<data.length;i++){
								var housing_icon=data[i].housing_icon;
								var qierlstat = 1;//有无720全景图的状态 1 没有 2是有 
								if(data[i].cloudscape == ''){
									if(housing_icon!=""){
										le=housing_icon.split(";").length;
										$(".imglunbo").html("1/"+le);
									}
									qierlstat = 1;
								}else{
									$('.qieryun').removeClass('qieryundisp');
									$('.qierldetu').removeClass('qierldetudisp');
									if(housing_icon!=""){
										le=housing_icon.split(";").length;
										$(".imglunbo").html("1/"+le);
									}
									qierlstat = 2;
								}
								
								$(".dj").html(data[i].dj==""?"暂无数据":data[i].dj+"元/㎡/天");
								$(".yzj").html(data[i].yzj==""?"暂无数据":data[i].yzj+"元/月");
								$(".fjmj").html(data[i].fjmj==""?"暂无数据":data[i].fjmj+"㎡");
								$(".krgw").html(data[i].krgw==""?"暂无数据":data[i].krgw);
								$(".chx").html(data[i].chx==""?"暂无数据":data[i].chx);
								$(".kprq").html(data[i].kprq==""?"暂无数据":data[i].kprq);
								$(".fjzt").html(data[i].fjzt==""?"暂无数据":data[i].fjzt);
								if(data[i].zglc == ''){
									$(".lc").html(data[i].lc==""?"暂无数据":data[i].lc+'/暂无数据');
								}else{
									$(".lc").html(data[i].lc==""?"暂无数据":data[i].lc +'/' + data[i].zglc);
								}
								titlet = data[i].topic;
								lianjiedizhi = data[i].cloudscape;
								
								//给720坐下面的图标加跳转链接
								$('.qierlyundelainjie').click(function(){
									mui.openWindow({ 
										url:'qierlyun.html', //需要打开页面的url地址 
										id:'qierlyun',  //需要打开页面的url页面id
										extras:{ 
											lianjie:lianjiedizhi,
											topic:titlet,
						//					.....//自定义扩展参数，可以用来处理页面间传值 
										}
									});
								});
								$(".fjcg").html(data[i].fjcg==""?"暂无数据":data[i].fjcg+"m");
								$(".wyf").html(data[i].wyf==""?"暂无数据":data[i].wyf+"元/㎡/月");
								$(".gnf").html(data[i].gnf==""?"暂无数据":data[i].gnf+"元/㎡/季");
								$(".tcf").html(data[i].tcf==""?"暂无数据":data[i].tcf+"元/月");
								$(".wygs").html(data[i].wygs==""?"暂无数据":data[i].wygs);
								if(data[i].zc==1){
									$(".zc").html("可注册");
								}else if(data[i].zc==0){
									$(".zc").html("不可注册");
								}else{
									$(".zc").html("暂无数据");
								}
								$(".chqxz").html(data[i].chqxz==""?"暂无数据":data[i].chqxz);
								$(".wlgs").html(data[i].wlgs==""?"暂无数据":data[i].wlgs);
								$(".topic").html(data[i].topic==""?"暂无数据":data[i].topic);
								$(".fybh").html(data[i].zdh+"-"+data[i].fybh);
//								$(".name").html(data[i].name==""?"暂无数据":data[i].name);
//								$(".phone").html(data[i].phone==""?"暂无数据":data[i].phone);
//								$('.xmjx a').attr('href','tel:'+data[i].phone);
								//图片轮播信息
								var h_img="";
								$(".mui-slider-loop").html(h_img);
								if(housing_icon!=""){
									var hous_img=housing_icon.split(";");
									var v1="";
									var v2="";
									for(var i=0;i<hous_img.length;i++){
										var ims=hous_img[i];
										if(i==0){
											if(qierlstat == 1){
												v1+=' <div class="mui-slider-item mui-slider-item-duplicate">';
												v1+='<a href="#">';
												v1+='<img src="'+img_url+ims+'" alt="" />';
												v1+=' </a> </div>';
											}else{
												
												
												v1+=' <div class="mui-slider-item mui-slider-item-duplicate">';
												v1+='<a href="#">';
												v1+='<img src="'+img_url+ims+'" alt="" />';
												v1+='<span class="fyxqdebofangan"><i></i></span>';
												v1+=' </a> </div>';
												
												
												
												
//												v1+=' <div class="mui-slider-item mui-slider-item-duplicate">';
//												v1+='<a href="#">';
//												v1+='<img src="http://47.92.145.21:81/yskjapp/lb1.png" alt="" />';
//												v1+='<span class="fyxqdebofangan"><i></i></span>';
//												v1+=' </a> </div>';
											}
											
										}else if(i==hous_img.length-1){
											v2+=' <div class="mui-slider-item mui-slider-item-duplicate">';
											v2+='<a href="#">';
											v2+='<img src="'+img_url+ims+'" alt="" />';
											v2+=' 123</a> </div>';
										}
									}

									for(var i=0;i<hous_img.length;i++){
											if(qierlstat == 1){
												var ims=hous_img[i];
												if(i==0){
													h_img+=v2;
												} 
												h_img+=' <div class="mui-slider-item">';
												h_img+='<a href="#">';
												h_img+='<img src="'+img_url+ims+'" alt="" />';
												h_img+=' </a> </div>';
												
												if(i==hous_img.length-1){
													h_img+=v1;
												}
											}else{
												var ims=hous_img[i];
												if(i==0){
													h_img+=v2;
													h_img+=' <div class="mui-slider-item">';
													h_img+='<a href="#">';
													h_img+='<img src="'+img_url+ims+'" alt="" />';
													h_img+='<span class="fyxqdebofangan"><i></i></span>';
													h_img+=' </a> </div>';
												}else{
													h_img+=' <div class="mui-slider-item">';
													h_img+='<a href="#">';
													h_img+='<img src="'+img_url+ims+'" alt="" />';
													h_img+=' </a> </div>';
												}
												
												
												if(i==hous_img.length-1){
													h_img+=v1;
												}
											}
											
										
									}									
									$(".mui-slider-loop").html(h_img);
									//给图片轮播的第一张图加播放按钮
									$('.fyxqdebofangan i').click(function(){
										mui.openWindow({ 
											url:'qierlyun.html', //需要打开页面的url地址 
											id:'qierlyun',  //需要打开页面的url页面id
											extras:{ 
												lianjie:lianjiedizhi,
												topic:titlet,
							//					.....//自定义扩展参数，可以用来处理页面间传值 
											}
										});
									});
									/*图片自动轮播*/
								ca.init();
								castapp.pictureScroll({
								    callback:function(pictureNumber){
					//				    console.log(pictureNumber);
								    },
								    isAutoScroll:true,
								    scrollTime:3
								});
								}
							}
						
					}else{
						mui.alert(data.message);
					}
				},
				error:function(xhr,type,errorThrown){
					//异常处理；
					console.log(type);
				}
			});
			}
			
			//获取前端登陆时的cookie,如果有则判断  房源是否已被收藏  改变收藏的样式
			function jugeHouse(){
			//alert("cookieId"+cookieId);
			if(cookieId){
				//判断房源是否被收藏  
				mui.ajax(url+'/yskjApp/appYskj/V1/judgeCollection.do',{
				data:{
							"cookie":cookieId,
							"fyid":fyid
						},
				dataType:'json',//服务器返回json格式数据
				type:'post',//HTTP请求类型
				timeout:100000,//超时时间设置为10秒；
				headers:{'Content-Type':'application/json'},	              
				success:function(data){
					
					if(data.success){
						//房源未被此用户收藏
						$(".xindebgimg").css({"background":"url(../img/fav2.png) no-repeat","background-size":"100% 100%"});
						$(".choucdeweziwidth").html("收藏");
					}else{
						if(data.message=="无此用户登陆信息"){
							//未登录
							$(".choucdeweziwidth").html("未收藏");
						}else if(data.message=="此房源已被此用户收藏"){
							//房源已被收藏
							collectId=data.collectId.toString();
							//图标转换
						//.xindebgimg{background:url(../img/fav2.png) no-repeat;background-size: 100% 100%;}
					    $(".xindebgimg").css({"background":"url(../img/fav.png) no-repeat","background-size":"100% 100%"});
						//alert("已被收藏   收藏Id"+data.collectId);
						$(".choucdeweziwidth").html("已收藏");
						}else{
							//错误提示信息
							mui.alert(data.message);
						}
					}
				},
				error:function(xhr,type,errorThrown){
					//异常处理；
					console.log(type);
				}
			});
			}
			}
			//如果没有获取到登录时的cookie，
			//点击收藏的时候 跳转到登录页面 进行登陆
			$('.choucdewezi').click(function(){
				var hl=	$(".choucdeweziwidth").html();
				if(hl=="未收藏"){
					//跳转到登录页面
					mui.alert("用户未登录，请先登录")
					mui.openWindow({
								url: 'login.html', 
								id:"login"
							});
					
				}else if(hl=="已收藏"){
					//取消收藏
					cancleCollect();
				}else if(hl=="收藏"){
					//收藏房源
					collectHouse();
				}
			})
			
			//取消收藏 收藏房源Id
			function cancleCollect(){
				mui.ajax(url+'/yskjApp/appYskj/V1/cancelCollect.do',{
				data:{
							"collectId":collectId
						},
				dataType:'json',//服务器返回json格式数据
				type:'post',//HTTP请求类型
				timeout:10000,//超时时间设置为10秒；
				headers:{'Content-Type':'application/json'},	              
				success:function(data){
					if(data.success){
						mui.alert("取消收藏房源");
						//判断收藏的状态 改变图标
						$(".choucdeweziwidth").html("收藏");
						$(".xindebgimg").css({"background":"url(../img/fav2.png) no-repeat","background-size":"100% 100%"});
						var main = plus.webview.getWebviewById('mysc_list');
						mui.fire(main, "shoucang",{
						    idx:888
						})
					}else{
						mui.alert("取消失败："+data.message);
					}
				},
				error:function(xhr,type,errorThrown){
					//异常处理；
					console.log(type);
				}
			});
				
			}
			//收藏房源
			function  collectHouse(){
				mui.ajax(url+'/yskjApp/appYskj/V1/collectHouse.do',{
				data:{
							"cookie":cookieId,
							"fyid":fyid
						},
				dataType:'json',//服务器返回json格式数据
				type:'post',//HTTP请求类型
				timeout:10000,//超时时间设置为10秒；
				headers:{'Content-Type':'application/json'},	              
				success:function(data){
					if(data.success){
						mui.alert("收藏房源成功"); 
						jugeHouse();
						//判断收藏的状态 改变图标
						$(".choucdeweziwidth").html("已收藏");
						 $(".xindebgimg").css({"background":"url(../img/fav.png) no-repeat","background-size":"100% 100%"});
					}else{
						mui.alert("收藏失败："+data.message);
					}
				},
				error:function(xhr,type,errorThrown){
					//异常处理；
					console.log(type);
				}
			});
			}
			document.querySelector('.mui-slider').addEventListener('slide', function(event) {
			  //注意slideNumber是从0开始的；
			  $('.imglunbo').html(event.detail.slideNumber+1+'/'+le);
			  /*alert("你正在看第"+(event.detail.slideNumber+1)+"张图片");*/
			});
            });
			/*window.addEventListener("fyyuadeqx", function (e) {
			    //获得事件参数
			
			});*/
            
			
		</script>
	</body>

</html>