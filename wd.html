<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<script src="js/mui.min.js"></script>
		<script type="text/javascript" src="js/lib/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="js/lib/flexible.js"></script>
		<script type="text/javascript" src="js/lib/flexible_css.js"></script>
		<link rel="stylesheet" type="text/css" href="css/style.css"/>
		<link rel="stylesheet" type="text/css" href="css/wd.css"/>
	</head>
	<style type="text/css">
		.mui-bar{
			position: initial;
		}
		.wd_zt{
			top: 0;
			overflow: hidden;
		}
		.wd_tel{
			padding-bottom: 0.666666rem;
		}
		.my_type{
			margin-bottom: 0.266666rem;
			border: 1px solid #e5e5e5;
		}
		.my_type li{
			position: relative;
			margin-bottom: 0!important;
			border-top: none;
		}
		.my_type li::after{
			position: absolute;
			bottom: 0;
			right: 0;
			content: '';
			display: block;
			width: 9.6rem;
			border-bottom: 1px solid #e5e5e5;
		}
		.my_type li:last-child::after{
			display: none;
		}
	</style>
	<body>
		<header class="mui-bar mui-bar-transparent bg-color-bg bar-h-s has-topbar-h">
		    <h1 class="mui-title"></h1>
		</header>
		<div class="mui-content wd_zt">
			<header class="mui-bar mui-bar-nav bg-color1">
			    <h1 class="mui-title wd_h">
			    	<p class="head_img">
			    		<img src="img/head_img.png" id="headImage"/>
			    	</p>
			    	<p class="user_news" id="login">
						<span class="ljdl">立即登录</span>
						<span class="dlcz">登录后可进行更多操作</span>
						<span class="wrz" style="display: none;">普通用户 <!--<span class="jt">＞</span>--></span> 
						<span class="yrz" style="display: none;">租户</span>
						<span class="sh" style="display: none;">业主</span>
			    	</p>
			    </h1>
			</header>
			<div class="after_service" style="display: none;">
	    		<p class="wode_sale">
	    			<span class="bancgird"></span>
	    			<span class="wode_diyigewenzi">管家服务</span>
	    		</p>
	    		<p class="wode_inmg">
	    			<span id="1" class="shebeiweixiu hetong_img"></span>
	    			<span id="2" class="shebeiweixiu zaixianshebei_img"></span>
	    			<span id="3" class="shebeiweixiu wuye_img"></span>
	    			<!--<span id="4" class="shebeiweixiu fangwupingz_img"></span>-->
	    			<span id="5" class="shebeiweixiu fangwu_img"></span>
	    		</p>
	    	</div>
		    <ul class="wd_list">
		    	<li id="grxx" class="tolink">
		    		<span class="wd_icon">
		    			<img src="img/per.png" alt="" />
		    		</span>
		    		<p>个人信息</p>
		    		<span class="mui-icon mui-icon-arrowright wd_con"></span>
		    	</li>
		    	<li id="wdsc" class="tolink">
		    		<span class="wd_icon">
		    			<img src="img/wode/tongzhi_center.png" alt="" />
		    		</span>
		    		<p>通知中心</p>
		    		<span class="mui-icon mui-icon-arrowright wd_con"></span>
		    	</li>
		    	<ul class="my_type">
			    	<li id="wdsc" class="tolink">
			    		<span class="wd_icon">
			    			<img src="img/fav.png" alt="" />
			    		</span>
			    		<p>我的收藏</p>
			    		<span class="mui-icon mui-icon-arrowright wd_con"></span>
			    	</li>
			    	<li id="wdsc" class="tolink">
			    		<span class="wd_icon">
			    			<img src="img/wode_fangyuan.png" alt="" />
			    		</span>
			    		<p>我的房源</p>
			    		<span class="mui-icon mui-icon-arrowright wd_con"></span>
			    	</li>
			    	<li id="wdsc" class="tolink">
			    		<span class="wd_icon">
			    			<img src="img/wode_guanjian.png" alt="" />
			    		</span>
			    		<p>我的管家</p>
			    		<span class="mui-icon mui-icon-arrowright wd_con"></span>
			    	</li>
		    	</ul>
		    	<li id="sz" class="tolink">
		    		<span class="wd_icon">
		    			<img src="img/sz.png" alt="" />
		    		</span>
		    		<p>设置</p>
		    		<span class="mui-icon mui-icon-arrowright wd_con"></span>
		    	</li>
		    </ul>
		    <p class="wd_tip">如有任何疑问请拨打咨询电话</p>
		    <p class="wd_tel"><a href="tel:400-078-8800" class="a_d">400-078-8800</a></p>
		</div>
		 <!--1<div class="sy_kfion">
				<p><a href="tel:400-078-8800"></a></p>
			</div>-->
		<script type="text/javascript" src="js/lib/app_config.js" ></script>
		<script type="text/javascript">
			var cookie=JSON.parse(localStorage.getItem('cookxs_yh'));
			var lostate = localStorage.getItem('lostate');
			if(lostate == null){
				$('.after_service').css('display','block');
			}
			(function(){
				
			   checkSubmit();
			})();
			mui.init();

			function checkSubmit(){
				if(cookie){
					var lostate = localStorage.getItem('lostate');  
					
				}else{
					
				}
			}
			window.addEventListener('customEvent', function(event) {
			    // mui.fire()传过来的额外的参数，在event.detail中；
			    var detail = event.detail;
			    var param = detail.ttt;
//			    alert(param1)
			    if(param == 1){
			    	var wobj = plus.webview.getWebviewById("wd.html");
					wobj.reload(true);
//					takeuser();
					
			    }
			});
			
			
			//跳转页面地址
			var toUrl = ['page/person.html','page/notice_center.html','page/mycollection.html','page/wode_fangyang.html','page/wode_guanjia.html','page/myset.html'];
			for(var i=0; i<$('.tolink').length; i++){
				(function(index){
					$('.tolink').eq(index).click(function(){
						if(index == 5){
							mui.openWindow({
								url:toUrl[index], //需要打开页面的url地址 
								id:'person'+index,  //需要打开页面的url页面id
								styles:{ 
									top:'0px',//新页面顶部位置 
									bottom:'0px',//新页面底部位置 
				//					width:newpage-width,//新页面宽度，默认为100% 
				//					height:newpage-height,//新页面高度，默认为100% ...... 
								}, 
								extras:{ 
			
				//					.....//自定义扩展参数，可以用来处理页面间传值 
								},show:{ //控制打开页面的类型
									autoShow:true,
				//					//页面loaded事件发生后自动显示，默认为true 
									aniShow:'slide-in-right',//页面显示动画，默认为”slide-in-right“；  页面出现的方式 左右上下
									duration:''//页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒； 
								}, waiting:{ // 控制 弹出转圈框的信息
									autoShow:true,//自动显示等待框，默认为true 
									title:'加载中...',//等待对话框上显示的提示内容 
									options:{ 
										width:'100px',//等待框背景区域宽度，默认根据内容自动计算合适宽度 
										height:'100px',//等待框背景区域高度，默认根据内容自动计算合适高度 ...... 
									} 
								}
							});
						}else{
							//判断是否在另一台设备登录的接口
							mui.ajax(url + '/yskjApp/appYskj/V1/landState.do',{
								data:{
									"cookie":cookie
								},
								dataType:'json',
								type:'post',
								timeout:10000,
								headers:{'Content-Type':'application/json'},	              
								success:function(data){
									console.log("用户登录状态： "+data.success);
									if(data.success){
										//已登录
										if(index==0||index==1||index==2||index==3||index==4){
											if(lostate==1){
												//登录状态
													mui.openWindow({
											url:toUrl[index], //需要打开页面的url地址 
											id:'person'+index,  //需要打开页面的url页面id
											styles:{ 
												top:'0px',//新页面顶部位置 
												bottom:'0px',//新页面底部位置 
							//					width:newpage-width,//新页面宽度，默认为100% 
							//					height:newpage-height,//新页面高度，默认为100% ...... 
											}, 
											extras:{ 
						
							//					.....//自定义扩展参数，可以用来处理页面间传值 
											},show:{ //控制打开页面的类型
												autoShow:true,
							//					//页面loaded事件发生后自动显示，默认为true 
												aniShow:'slide-in-right',//页面显示动画，默认为”slide-in-right“；  页面出现的方式 左右上下
												duration:''//页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒； 
											}, waiting:{ // 控制 弹出转圈框的信息
												autoShow:true,//自动显示等待框，默认为true 
												title:'加载中...',//等待对话框上显示的提示内容 
												options:{ 
													width:'100px',//等待框背景区域宽度，默认根据内容自动计算合适宽度 
													height:'100px',//等待框背景区域高度，默认根据内容自动计算合适高度 ...... 
												} 
											}
										});
											}else{
												//未登录状态
														mui.openWindow({
											  				url: './page/login.html', 
											  				id:'login'
															});	
											}
											
										}else{
										mui.openWindow({ 
											url:toUrl[index], //需要打开页面的url地址 
											id:'person'+index,  //需要打开页面的url页面id
											styles:{ 
												top:'0px',//新页面顶部位置 
												bottom:'0px',//新页面底部位置 
							//					width:newpage-width,//新页面宽度，默认为100% 
							//					height:newpage-height,//新页面高度，默认为100% ...... 
											}, 
											extras:{ 
												
							//					.....//自定义扩展参数，可以用来处理页面间传值 
											},show:{ //控制打开页面的类型
												autoShow:true,
							//					//页面loaded事件发生后自动显示，默认为true 
												aniShow:'slide-in-right',//页面显示动画，默认为”slide-in-right“；  页面出现的方式 左右上下
												duration:''//页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒； 
											}, waiting:{ // 控制 弹出转圈框的信息
												autoShow:true,//自动显示等待框，默认为true 
												title:'加载中...',//等待对话框上显示的提示内容 
												options:{ 
													width:'100px',//等待框背景区域宽度，默认根据内容自动计算合适宽度 
													height:'100px',//等待框背景区域高度，默认根据内容自动计算合适高度 ...... 
												} 
											}
										});
										}
									}else{
										//未登录
										localStorage.removeItem('cookxs_yh');
										localStorage.removeItem('userInfos');
										localStorage.removeItem('weinxin_shouquan');
										localStorage.removeItem('lostate');
										localStorage.removeItem('user_type');
										localStorage.removeItem('user_id');
										mui.openWindow({
										  url: './page/login.html', 
										  id:'login'
										});
										return;
									}
								},
								error:function(xhr,type,errorThrown){
									console.log(type);
								}
							});
						}
						
					})
				})(i)		
			}
			//立即登陆
			document.getElementsByClassName('ljdl')[0].addEventListener('tap', function() {
				//判断是否在另一台设备登录的接口
				mui.ajax(url + '/yskjApp/appYskj/V1/landState.do',{
					data:{
						"cookie":cookie
					},
					dataType:'json',
					type:'post',
					timeout:10000,
					headers:{'Content-Type':'application/json'},	              
					success:function(data){
						console.log("用户登录状态： "+data.success);
						if(data.success){
							//已登录
							if(lostate==1){
								//跳转登陆页面
								mui.openWindow({
								  url: './page/person.html', 
								  id:'person'
								});		
								return
							}else{
								//跳转登陆页面
								mui.openWindow({
								  url: './page/login.html', 
								  id:'login'
								});					
							}
						}else{
							//未登录
							localStorage.removeItem('cookxs_yh');
							localStorage.removeItem('userInfos');
							localStorage.removeItem('weinxin_shouquan');
							localStorage.removeItem('lostate');
							localStorage.removeItem('user_type');
							localStorage.removeItem('user_id');
							mui.openWindow({
							  url: './page/login.html', 
							  id:'login'
							});
							return;
						}
					},
					error:function(xhr,type,errorThrown){
						console.log(type);
					}
				});
				
			});
			//登陆成功后获取用户信息
			function gainUser(){
				mui.ajax(url + '/yskjApp/appYskj/V1/getCookieInfo.do',{
					data:{
						"cookie":JSON.parse(localStorage.getItem('cookxs_yh'))
					},
					dataType:'json',
					type:'post',
					timeout:10000,
					headers:{'Content-Type':'application/json'},	              
					success:function(data){
						if(data.success){
							var userData = data.data;
							//将手机号中间加密
							var type = userData.typeid;
							//售后服务这块判断登没有登录
							if(lostate==1 && type==2){
								$('.after_service').css('display','none');
							}else{
								$('.after_service').css('display','block');
							}
							var phone = userData.phone;
							var reg = /^(\d{3})\d{4}(\d{4})$/;
							phone = phone.replace(reg, "$1****$2");
							if(localStorage.getItem('weinxin_shouquan')){
								
							}else{
								if(userData.name == null || userData.name == 'null' || userData.name == ''){
									$('.ljdl').html(phone);
								}else{
									$('.ljdl').html(userData.name);
								}
							}
							
							//1 渠道用户 2 业主用户 3 客户用户
							if(type==1){
								$('.dlcz').css('display','none');
								$('.yrz').css('display','none');
								$('.wrz').css('display','block');
							}
							if(type==2){
								$('.dlcz').css('display','none');
								$('.wrz').css('display','none');
								$('.yrz').css('display','none');
								$('.sh').css('display','block');
							}else{
								$('.after_service').css('display','block');
							}
							if(type==3){
								$('.dlcz').css('display','none');
								$('.wrz').css('display','none');
								$('.yrz').css('display','block');
							}
							return;
						}else{
//							mui.toast(data.message,{ duration:'2000', type:'div' }) 
							return;
						}
					},
					error:function(xhr,type,errorThrown){
						console.log(type);
					}
				});
			}
			//获取信息方法
			function takeuser(){
//				alert('信息获取')
				if(JSON.parse(localStorage.getItem('cookxs_yh'))){
					gainUser();
				}else{
					$('.ljdl').html('立即登录');
					$('.dlcz').css('display','block');
					$('.wrz').css('display','none');
					$('.yrz').css('display','none');
				}			
			}
			//判断他的登录方式
			if(localStorage.getItem('weinxin_shouquan')){
				showuserinfo();
				gainUser();
			}else{
				takeuser();
			}
//			$('.wrz').click(function(){
//				//跳转认证页面
//				mui.openWindow({
//				  url: './page/sfrz.html', 
//				  id:'add_name4'
//				});
//			});
			//渲染用户信息（微信登录）
			function showuserinfo(){
				var data = JSON.parse(localStorage.getItem('userInfos'));
				var type = JSON.parse(localStorage.getItem('user_type'));
		    	$('#headImage').attr('src',data.headimgurl);
		    	$('.ljdl').html(data.nickname);
		    	if(type==1){
					$('.dlcz').css('display','none');
					$('.yrz').css('display','none');
					$('.wrz').css('display','block');
				}
				if(type==2){
					$('.dlcz').css('display','none');
					$('.wrz').css('display','none');
					$('.yrz').css('display','none');
					$('.sh').css('display','block');
				}
				if(type==3){
					$('.dlcz').css('display','none');
					$('.wrz').css('display','none');
					$('.yrz').css('display','block');
				}
			}

	        //售后服务的点击事件
	        $('.shebeiweixiu').click(function(){
	        	var saleid = this.id;
	        	//判断是否在另一台设备登录的接口
	        	mui.ajax(url + '/yskjApp/appYskj/V1/landState.do',{
					data:{
						"cookie":cookie
					},
					dataType:'json',
					type:'post',
					timeout:10000,
					headers:{'Content-Type':'application/json'},	              
					success:function(data){
						console.log("用户登录状态： "+data.success);
						if(data.success){
							//已登录
				        	mui.openWindow({
							  url: './page/repairs_bx.html', 
							  id:'repairs_bx',
							  extras:{ 
								 saleid:saleid,
							  }
							});
						}else{
							//未登录
							localStorage.removeItem('cookxs_yh');
							localStorage.removeItem('userInfos');
							localStorage.removeItem('weinxin_shouquan');
							localStorage.removeItem('lostate');
							localStorage.removeItem('user_type');
							localStorage.removeItem('user_id');
							mui.openWindow({
							  url: './page/login.html', 
							  id:'login'
							});
							return;
						}
					},
					error:function(xhr,type,errorThrown){
						console.log(type);
					}
				});
	        	
	        });
		</script>
	</body>

</html>